# Jornadas de Trabalho - Implementa√ß√£o Completa

## Status: ‚úÖ COMPLETO E FUNCIONAL

Sistema completo de cadastro e gest√£o de jornadas de trabalho no painel admin-tenant.

---

## üì¶ Arquivos Criados/Modificados

### 1. **Database - Migrations**

#### `database/migrations/2025_10_21_214455_create_work_schedules_table.php`
Tabela principal de jornadas de trabalho com:
- **Informa√ß√µes b√°sicas**: `name`, `code`, `description`
- **Carga hor√°ria**: `weekly_hours`, `daily_hours`, `break_minutes`
- **Hor√°rios padr√£o**: `default_start_time`, `default_end_time`, `default_break_start`, `default_break_end`
- **Configura√ß√£o por dia**: `days_config` (JSON) - permite configurar cada dia da semana individualmente
- **Toler√¢ncias**: `tolerance_minutes_entry`, `tolerance_minutes_exit`
- **Configura√ß√µes extras**: `consider_holidays`, `allow_overtime`, `is_active`
- **Relacionamentos**: `tenant_id` (foreign key)
- **Soft deletes**: Permite exclus√£o l√≥gica

#### `database/migrations/2025_10_21_215708_add_work_schedule_id_to_employees_table.php`
Adiciona relacionamento de funcion√°rio com jornada:
- Campo `work_schedule_id` (nullable, foreign key)
- `nullOnDelete` - se jornada for exclu√≠da, funcion√°rio n√£o perde dados

**Status**: ‚úÖ Migrations executadas com sucesso

---

### 2. **Models**

#### `app/Models/WorkSchedule.php`
Model completo com:
- **SoftDeletes** trait
- **Fillable fields** - todos os campos configur√°veis
- **Casts** - convers√£o autom√°tica de tipos (boolean, integer, array)
- **Relacionamentos**:
  - `tenant()` - BelongsTo Tenant
  - `employees()` - HasMany Employee
- **Helper methods**:
  - `getDayConfig(string $day)` - retorna config de um dia espec√≠fico
  - `worksOnDay(string $day)` - verifica se trabalha em determinado dia
  - `getWorkingDays()` - retorna array com dias que trabalha

#### `app/Models/Employee.php` (atualizado)
- Adicionado `work_schedule_id` ao `$fillable`
- Adicionado relacionamento `workSchedule()` - BelongsTo WorkSchedule

---

### 3. **Views - Livewire Component**

#### `resources/views/livewire/admin/work-schedules/index.blade.php`
Component Livewire Volt completo (1.300+ linhas) com:

**Funcionalidades:**
- ‚úÖ **Listagem paginada** de jornadas
- ‚úÖ **Busca em tempo real** (nome, c√≥digo, descri√ß√£o)
- ‚úÖ **Modal de cria√ß√£o/edi√ß√£o** com todos os campos
- ‚úÖ **Exclus√£o** com confirma√ß√£o (verifica se h√° funcion√°rios vinculados)
- ‚úÖ **Toggle de status** (ativar/desativar)
- ‚úÖ **Valida√ß√£o completa** de formul√°rio
- ‚úÖ **Flash messages** (sucesso/erro)
- ‚úÖ **Responsivo** e moderno (Tailwind CSS)

**Campos do Formul√°rio:**
1. **Informa√ß√µes B√°sicas**
   - Nome da Jornada
   - C√≥digo (√∫nico, uppercase)
   - Descri√ß√£o (opcional)
   - Status (ativo/inativo)

2. **Carga Hor√°ria**
   - Horas semanais (1-60)
   - Horas di√°rias (1-24)
   - Intervalo em minutos (0-480)

3. **Hor√°rios Padr√£o**
   - Hor√°rio de entrada (time picker)
   - Hor√°rio de sa√≠da (time picker)
   - In√≠cio do intervalo
   - Fim do intervalo

4. **Dias de Trabalho**
   - Checkboxes para cada dia da semana
   - Segunda a Domingo
   - Padr√£o: Segunda a Sexta ativados

5. **Toler√¢ncias**
   - Toler√¢ncia entrada (0-120 min)
   - Toler√¢ncia sa√≠da (0-120 min)

6. **Configura√ß√µes Adicionais**
   - Considerar feriados (checkbox)
   - Permitir horas extras (checkbox)

**Design:**
- Gradientes azul/√≠ndigo
- Cards coloridos por se√ß√£o (cinza, azul, √≠ndigo, verde, amarelo, roxo)
- Modal responsivo com scroll
- Sticky header e footer no modal
- Hover effects e transi√ß√µes suaves
- √çcones SVG consistentes

---

### 4. **Views - Wrapper**

#### `resources/views/admin/work-schedules/index.blade.php`
View simples que extends o layout principal e carrega o Livewire component.

---

### 5. **Routes**

#### `routes/web.php` (modificado)
Nova rota adicionada no grupo admin:
```php
Route::get('/work-schedules', function () {
    return view('admin.work-schedules.index');
})->name('work-schedules.index');
```

**Middleware aplicado:**
- `auth` - requer autentica√ß√£o
- `tenant.active` - tenant deve estar ativo

**Acesso:** Todos os usu√°rios autenticados do tenant podem acessar

---

### 6. **Navigation Menu**

#### `resources/views/layouts/app.blade.php` (modificado)
Menu adicionado na se√ß√£o "Gest√£o", logo ap√≥s "Funcion√°rios":
- √çcone de calend√°rio
- Label: "Jornadas"
- Highlight autom√°tico quando rota ativa
- Gradiente azul quando selecionado

---

## üé® Interface Visual

### Tela de Listagem
- **Header**: T√≠tulo + bot√£o "Nova Jornada"
- **Busca**: Campo com √≠cone de lupa
- **Tabela**: 7 colunas
  1. Nome (com descri√ß√£o abaixo)
  2. C√≥digo (badge azul)
  3. Horas Semanais (ex: "44h/sem")
  4. Hor√°rio Padr√£o (ex: "08:00 - 17:00")
  5. Dias Ativos (ex: "5 dias")
  6. Status (badge verde/vermelho com toggle)
  7. A√ß√µes (editar/excluir)
- **Pagina√ß√£o**: Links do Laravel
- **Empty state**: Mensagem + √≠cone quando vazio

### Modal de Cadastro/Edi√ß√£o
- **Layout**: 2 colunas responsivo
- **Se√ß√µes coloridas**:
  - Cinza: Informa√ß√µes b√°sicas
  - Azul: Carga hor√°ria
  - √çndigo: Hor√°rios padr√£o
  - Verde: Dias de trabalho
  - Amarelo: Toler√¢ncias
  - Roxo: Configura√ß√µes adicionais
- **Valida√ß√£o**: Mensagens em vermelho abaixo dos campos
- **Bot√µes**: Cancelar (cinza) + Salvar (gradiente azul)

---

## üîß Como Usar

### 1. Acessar o M√≥dulo
```
http://localhost:8000/admin/work-schedules
```

### 2. Criar Nova Jornada
1. Clique em "Nova Jornada"
2. Preencha os campos obrigat√≥rios:
   - Nome (ex: "Jornada Padr√£o 44h")
   - C√≥digo (ex: "JOR-001")
   - Horas semanais (ex: 44)
   - Horas di√°rias (ex: 8)
   - Intervalo (ex: 60 minutos)
3. Configure hor√°rios (opcional)
4. Selecione dias de trabalho
5. Ajuste toler√¢ncias
6. Marque op√ß√µes adicionais
7. Clique em "Salvar"

### 3. Editar Jornada
1. Clique no √≠cone de l√°pis na linha da jornada
2. Altere os campos desejados
3. Clique em "Atualizar"

### 4. Excluir Jornada
1. Clique no √≠cone de lixeira
2. Confirme a exclus√£o
3. **Aten√ß√£o**: N√£o √© poss√≠vel excluir jornadas com funcion√°rios vinculados

### 5. Ativar/Desativar
- Clique no badge de status (verde/vermelho)
- Alterna entre Ativo/Inativo instantaneamente

### 6. Buscar Jornadas
- Digite no campo de busca
- Busca autom√°tica por: nome, c√≥digo ou descri√ß√£o

---

## üìä Estrutura do Banco de Dados

### Tabela: `work_schedules`

| Campo | Tipo | Descri√ß√£o |
|-------|------|-----------|
| `id` | BIGINT | ID √∫nico |
| `tenant_id` | BIGINT | FK para tenants |
| `name` | VARCHAR | Nome da jornada |
| `code` | VARCHAR | C√≥digo √∫nico |
| `description` | TEXT | Descri√ß√£o (opcional) |
| `weekly_hours` | INTEGER | Horas semanais |
| `daily_hours` | INTEGER | Horas di√°rias |
| `break_minutes` | INTEGER | Minutos de intervalo |
| `default_start_time` | TIME | Hor√°rio entrada padr√£o |
| `default_end_time` | TIME | Hor√°rio sa√≠da padr√£o |
| `default_break_start` | TIME | In√≠cio intervalo |
| `default_break_end` | TIME | Fim intervalo |
| `days_config` | JSON | Configura√ß√£o por dia |
| `tolerance_minutes_entry` | INTEGER | Toler√¢ncia entrada |
| `tolerance_minutes_exit` | INTEGER | Toler√¢ncia sa√≠da |
| `consider_holidays` | BOOLEAN | Considera feriados |
| `allow_overtime` | BOOLEAN | Permite horas extras |
| `is_active` | BOOLEAN | Status ativo |
| `created_at` | TIMESTAMP | Data cria√ß√£o |
| `updated_at` | TIMESTAMP | Data atualiza√ß√£o |
| `deleted_at` | TIMESTAMP | Soft delete |

### Exemplo de `days_config` (JSON):
```json
{
  "monday": {
    "active": true,
    "label": "Segunda-feira"
  },
  "tuesday": {
    "active": true,
    "label": "Ter√ßa-feira"
  },
  "wednesday": {
    "active": true,
    "label": "Quarta-feira"
  },
  "thursday": {
    "active": true,
    "label": "Quinta-feira"
  },
  "friday": {
    "active": true,
    "label": "Sexta-feira"
  },
  "saturday": {
    "active": false,
    "label": "S√°bado"
  },
  "sunday": {
    "active": false,
    "label": "Domingo"
  }
}
```

### Tabela: `employees` (campo adicionado)

| Campo | Tipo | Descri√ß√£o |
|-------|------|-----------|
| `work_schedule_id` | BIGINT | FK para work_schedules (nullable) |

---

## üîó Relacionamentos

```
Tenant (1) ‚îÄ‚îÄ‚îÄ‚îÄ (N) WorkSchedule
WorkSchedule (1) ‚îÄ‚îÄ‚îÄ‚îÄ (N) Employee
Tenant (1) ‚îÄ‚îÄ‚îÄ‚îÄ (N) Employee
```

---

## üéØ Valida√ß√µes Implementadas

### Backend (Livewire)
- `name`: required, string, max 255
- `code`: required, string, max 50, unique (exceto na edi√ß√£o)
- `description`: nullable, string
- `weekly_hours`: required, integer, 1-60
- `daily_hours`: required, integer, 1-24
- `break_minutes`: required, integer, 0-480
- `default_start_time`: nullable, formato H:i
- `default_end_time`: nullable, formato H:i
- `default_break_start`: nullable, formato H:i
- `default_break_end`: nullable, formato H:i
- `tolerance_minutes_entry`: required, integer, 0-120
- `tolerance_minutes_exit`: required, integer, 0-120

### Regras de Neg√≥cio
- ‚úÖ C√≥digo sempre em uppercase
- ‚úÖ Verifica funcion√°rios vinculados antes de excluir
- ‚úÖ Soft delete (n√£o apaga permanentemente)
- ‚úÖ Tenant isolado (apenas jornadas do pr√≥prio tenant)

---

## üöÄ Pr√≥ximos Passos Sugeridos

### 1. Integra√ß√£o com Funcion√°rios
- [ ] Adicionar select de jornada no cadastro de funcion√°rios
- [ ] Permitir vincular/desvincular jornada na edi√ß√£o
- [ ] Mostrar jornada atual na listagem de funcion√°rios

### 2. Hor√°rios Personalizados por Dia
- [ ] Permitir configurar hor√°rios diferentes para cada dia da semana
- [ ] Ex: Segunda 8h-17h, Sexta 8h-16h

### 3. C√°lculo de Horas
- [ ] Usar jornada para calcular horas trabalhadas
- [ ] Calcular horas extras automaticamente
- [ ] Aplicar toler√¢ncias nos registros de ponto

### 4. Feriados
- [ ] Integrar com API de feriados (Invertexto)
- [ ] Cadastro manual de feriados por tenant
- [ ] N√£o contabilizar trabalho em feriados (se `consider_holidays` ativo)

### 5. Relat√≥rios
- [ ] Relat√≥rio de horas por jornada
- [ ] Comparativo de jornadas
- [ ] Funcion√°rios por jornada

### 6. Dashboard
- [ ] Card com total de jornadas ativas
- [ ] Gr√°fico de funcion√°rios por jornada
- [ ] Jornadas mais usadas

### 7. Valida√ß√µes Avan√ßadas
- [ ] Validar se hor√°rio de sa√≠da > hor√°rio de entrada
- [ ] Validar se intervalo est√° dentro do expediente
- [ ] Alerta se horas semanais extrapolam limite legal

### 8. Exporta√ß√£o
- [ ] Exportar jornadas para PDF
- [ ] Exportar jornadas para Excel
- [ ] Template de importa√ß√£o em massa

---

## üìù Exemplos de Uso

### Jornada CLT Padr√£o (44h semanais)
```
Nome: Jornada CLT 44h
C√≥digo: CLT-44
Horas Semanais: 44
Horas Di√°rias: 8 (8h48m na pr√°tica)
Intervalo: 60 minutos
Hor√°rio: 08:00 - 17:00
Dias: Segunda a Sexta
Toler√¢ncia: 10 minutos
```

### Jornada 6x1 (Comercial)
```
Nome: Jornada 6x1 Comercial
C√≥digo: 6X1-COM
Horas Semanais: 44
Horas Di√°rias: 7 (7h20m na pr√°tica)
Intervalo: 60 minutos
Hor√°rio: 09:00 - 17:00
Dias: Segunda a S√°bado
Toler√¢ncia: 5 minutos
```

### Jornada Meio Per√≠odo
```
Nome: Meio Per√≠odo Manh√£
C√≥digo: MP-MANHA
Horas Semanais: 20
Horas Di√°rias: 4
Intervalo: 0 minutos
Hor√°rio: 08:00 - 12:00
Dias: Segunda a Sexta
Toler√¢ncia: 10 minutos
```

### Jornada Turnos (12x36)
```
Nome: Jornada 12x36
C√≥digo: 12X36
Horas Semanais: 42
Horas Di√°rias: 12
Intervalo: 60 minutos
Hor√°rio: 07:00 - 19:00
Dias: Configura√ß√£o alternada (via days_config)
Toler√¢ncia: 15 minutos
```

---

## üé® Screenshots (Descri√ß√£o)

### Tela de Listagem
```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  Jornadas de Trabalho              [+ Nova Jornada]        ‚ïë
‚ïë  Gerencie as escalas e hor√°rios de trabalho                ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  [üîç Buscar por nome, c√≥digo ou descri√ß√£o...]              ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Nome  ‚îÇ C√≥digo ‚îÇ H/Sem   ‚îÇ Hor√°rio  ‚îÇ Dias  ‚îÇ Status‚îÇ A√ß√µes‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë CLT   ‚îÇ CLT-44 ‚îÇ 44h/sem ‚îÇ 08-17h   ‚îÇ 5dias ‚îÇ Ativo ‚îÇ ‚úèÔ∏èüóëÔ∏è ‚ïë
‚ïë 6x1   ‚îÇ 6X1-01 ‚îÇ 44h/sem ‚îÇ 09-17h   ‚îÇ 6dias ‚îÇ Ativo ‚îÇ ‚úèÔ∏èüóëÔ∏è ‚ïë
‚ïë Meio  ‚îÇ MP-001 ‚îÇ 20h/sem ‚îÇ 08-12h   ‚îÇ 5dias ‚îÇInativo‚îÇ ‚úèÔ∏èüóëÔ∏è ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## üêõ Tratamento de Erros

### Exclus√£o Protegida
```
‚ùå N√£o √© poss√≠vel excluir esta jornada pois existem
   funcion√°rios vinculados.
```

### C√≥digo Duplicado
```
‚ùå O campo c√≥digo j√° est√° em uso.
```

### Valida√ß√£o de Campos
```
‚ùå O campo horas semanais deve ser entre 1 e 60.
```

---

## üìû Suporte

### Logs
- **Laravel Logs**: `storage/logs/laravel.log`
- **Browser Console**: Livewire debugger (F12)

### Troubleshooting

**Problema:** Modal n√£o abre
- **Solu√ß√£o**: Verifique se Livewire est√° carregado (`@livewireScripts`)

**Problema:** Jornada n√£o salva
- **Solu√ß√£o**: Verifique valida√ß√µes no console e logs do Laravel

**Problema:** N√£o aparece no menu
- **Solu√ß√£o**: Verifique permiss√µes do usu√°rio e rota em `web.php`

---

## üèÜ Tecnologias Utilizadas

- **Backend**: Laravel 11
- **Frontend**: Livewire Volt 3
- **UI**: Tailwind CSS 3
- **Database**: MySQL/PostgreSQL
- **Icons**: Heroicons (SVG)

---

## ‚úÖ Checklist de Implementa√ß√£o

- [x] Migration `create_work_schedules_table`
- [x] Migration `add_work_schedule_id_to_employees`
- [x] Model `WorkSchedule` completo
- [x] Model `Employee` atualizado
- [x] Livewire Component com CRUD
- [x] View wrapper
- [x] Rota registrada
- [x] Menu de navega√ß√£o
- [x] Relacionamentos configurados
- [x] Valida√ß√µes backend
- [x] Flash messages
- [x] Soft deletes
- [x] Design responsivo
- [x] Documenta√ß√£o completa

---

**Desenvolvido por**: Claude Code (Anthropic)
**Data**: 21/10/2025
**Vers√£o**: 1.0.0
**Status**: ‚úÖ Produ√ß√£o Ready
